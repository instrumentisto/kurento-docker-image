# Kurento Docker image tests configuration.
#
# More details at:
# https://github.com/aelsabbahy/goss/blob/master/docs/manual.md#available-tests

# Check Kurento packages
package:
  # gStreamer v1.5 installed
  libgstreamer1.5-0:amd64:
    installed: true
    versions:
      - 1.8.1.1.xenial~20181018130734.170.0d6031b
  # gstreamer1.5-plugins-base installed
  gstreamer1.5-plugins-base:
    installed: true
    versions:
      - 1.8.1.1.xenial~20181018132104.55.7b19cfd
  # libnice installed
  gstreamer1.5-nice:
    installed: true
    versions:
      - 0.1.15-1kurento2~20181207131058.gbp03e0b4
  # gstreamer1.5-plugins-bad installed
  gstreamer1.5-plugins-bad:amd64:
    installed: true
    versions:
      - 1.8.1.1.xenial~20181018134602.100.3db37b1
  # gstreamer1.5-plugins-ugly installed
  gstreamer1.5-plugins-ugly:
    installed: true
    versions:
      - 1.8.1.1.xenial~20181018140138.89.2685b0f
  # gstreamer1.5-libav installed
  gstreamer1.5-libav:
    installed: true
    versions:
      - 1.8.2.1.xenial~20181018140706.96.493eee4
  # gstreamer1.5-tools installed
  gstreamer1.5-tools:
    installed: true
    versions:
      - 1.8.1.1.xenial~20181018130734.170.0d6031b
  # checks openh26 installed
  openh264:
    installed: true
    versions:
      - 1.4.0.xenial~20181018130100.2.5faa3d1

# Check Kurento port listening
port:
  # Listens on WebSocket port
  tcp6:8888:
    listening: true
    ip:
      - '::'
  # Listens on health-check HTTP endpoint port.
  tcp6:9092:
    listening: true
    ip:
      - '::'

# Check processes running
process:
  # supervisord runs
  supervisord:
    running: true

# Check supervisor's children running
command:
  supervisorctl:
    exit-status: 0
    stdout:
      - /healthcheck\s*RUNNING/
      - /kms\s*RUNNING/
    stderr: []
    timeout: 10000

file:
  /kurento-media-server/server/config/kurento/WebRtcEndpoint.conf.ini:
    exists: true
    filetype: file
    mode: "0644"
    contains:
      - "turnURL=test_turn_url"
      - "stunServerAddress=test_stun_ip"
      - "stunServerPort=1234"
